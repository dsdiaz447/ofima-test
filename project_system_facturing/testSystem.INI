[SERVIDOR]
SERVER=LTECNICO\SQLSERVER
DRIVER_ODBC=ODBC Driver 17 for SQL Server

[SYS_TEST-PRACTICE]
BASEDEDATOS=BD_TEST_PRACTICE
USUARIO=test-practice
CLAVE=Ofima2024









LOCAL lcConexion, lcServidor, lcBaseDatos, lcUsuario, lcClave

* Configuración de la conexión
lcServidor  = "LTECNICO\SQLSERVER"
lcBaseDatos = "BD_TEST_PRACTICE"
lcUsuario   = "test-practice"
lcClave     = "Ofima2024"


* Crear cadena de conexión
lcConexion = "Driver={ODBC Driver 17 for SQL Server};Server=" + lcServidor + ";Database=" + lcBaseDatos + ";Uid=" + lcUsuario + ";Pwd=" + lcClave + ";"

IF !DBUSED(lcBaseDatos)
	SQLSTRINGCONNECT(lcConexion)
ENDIF 

STORE SYS(3)+".IDX" TO mIndice

* Seleccionar la tabla BD_TEST_PRACTICE
USE TB_FIRST_MENU IN 0 ALIAS OpcionesMenu  
INDEX on POSMENU TO &mIndice

LOCAL lcAlias
lcAlias = ALIAS()

WITH ThisForm.oOpcionesLaterales
    WITH .W_MENU1
        * Insertar filas en el control W_MENU1
        SELECT OpcionesMenu
        SCAN
            .DO_INSERTAR_FILA(ALLTRIM(POSMENU),ALLTRIM(DESCRIPTION_MENU),ALLTRIM(ICONO_MENU))
        ENDSCAN
    ENDWITH
ENDWITH

  *--- Se agrega la cantidad de nodos que tiene cada opción, para saber si una opción tiene subopciones
  
  SELECT CURSOR_OPCIONES
  
  SCAN
    lnNumReg = RECNO()
    lcOpcion = ALLTRIM(CUR_OPCION)
    COUNT FOR LEFT(ALLTRIM(CUR_OPCION), LEN(lcOpcion)) == lcOpcion TO lnCantid
    GO lnNumReg
    REPLACE CUR_CANNOD WITH lnCantid
  ENDSCAN
  
  *--- Se eliminan los formularios visibles en la pantalla
  
  FOR lnI = _Screen.oColeccionForms.Count TO 1 STEP -1               && Se recorren los formularios de atrás para adelante
    loForm = _Screen.oColeccionForms.Item[lnI]                       && Se obtiene un objeto de tipo formulario
    IF Upper(loForm.Name) <> UPPER("FormOpcionesLaterales") THEN     && El formulario FormOpcionesLaterales no debe ser eliminado, todos los otros formularios sí
      loForm.RELEASE()                                               && Libera al formulario de la memoria
    ENDIF  
  ENDFOR
  
  *--- Se sale de este método
  
  IF !EMPTY(lcAlias) THEN
    SELECT (lcAlias)
  ENDIF
  
RETURN
*
*
* tcOpcion, tcNombre, tcIconox, tcComand, tcAyudax, tnBackCo, tnForeCo, tcFontNa, tnFontSi, tnBackSe, tnForeSe, tlHabili, tlVisibl